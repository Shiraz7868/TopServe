<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Account - TopServe</title><link rel="stylesheet" href="style.css"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script></head><body>
<div class="container" id="auth-container">
    <!-- Form will be dynamically inserted here -->
</div>
<script>
    const SUPABASE_URL = 'https://lyqdnxaxisnipeogtzfm.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5cWRueGF4aXNuaXBlb2d0emZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MDA5NzEsImV4cCI6MjA2NzE3Njk3MX0.RLhRacgqtvXk2-qaQ3ZCLYkcshg5_kIN5Mko6WMouWw';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const authContainer = document.getElementById('auth-container');

    const showError = (msg) => { const el = document.getElementById('error-msg'); if(el) { el.innerText = msg; el.style.display = 'block'; } };
    const clearError = () => { const el = document.getElementById('error-msg'); if(el) { el.innerText = ''; el.style.display = 'none'; } };

    const loginTemplate = `<h2>Login to TopServe</h2><p id="error-msg" class="error-msg"></p><label for="email">Email</label><input type="email" id="login-email" required><label for="password">Password</label><input type="password" id="login-password" required><button id="login-btn">Login</button><p class="switcher">Don't have an account? <a href="#" id="show-register">Register here</a></p>`;
    const registerTemplate = `<h2>Create Your Account</h2><p id="error-msg" class="error-msg"></p><label for="username">Username</label><input type="text" id="reg-username" required><label for="email">Email</label><input type="email" id="reg-email" required><label for="password">Password (min. 6 characters)</label><input type="password" id="reg-password" required><button id="register-btn">Register</button><p class="switcher">Already have an account? <a href="#" id="show-login">Login here</a></p>`;

    function showLoginForm() {
        authContainer.innerHTML = loginTemplate;
        document.getElementById('login-btn').addEventListener('click', loginUser);
        document.getElementById('show-register').addEventListener('click', showRegisterForm);
    }

    function showRegisterForm() {
        authContainer.innerHTML = registerTemplate;
        document.getElementById('register-btn').addEventListener('click', registerUser);
        document.getElementById('show-login').addEventListener('click', showLoginForm);
    }

    async function loginUser() {
        clearError();
        const btn = document.getElementById('login-btn'); btn.disabled = true; btn.innerText = 'Logging in...';
        const { error } = await supabaseClient.auth.signInWithPassword({ email: document.getElementById('login-email').value, password: document.getElementById('login-password').value });
        if (error) { showError(error.message); btn.disabled = false; btn.innerText = 'Login'; } else { window.location.href = 'dashboard.html'; }
    }

    async function registerUser() {
        clearError();
        const btn = document.getElementById('register-btn'); btn.disabled = true; btn.innerText = 'Registering...';
        const username = document.getElementById('reg-username').value.trim();
        const email = document.getElementById('reg-email').value;
        const password = document.getElementById('reg-password').value;

        if (username.length < 3) { showError("Username must be at least 3 characters."); btn.disabled = false; btn.innerText = 'Register'; return; }

        const { data: { user }, error } = await supabaseClient.auth.signUp({ email, password });
        if (error) { showError(error.message); } 
        else if (user) {
            const { error: profileError } = await supabaseClient.from('profiles').insert({ id: user.id, username: username });
            if (profileError) { showError("Could not create profile: " + profileError.message); } 
            else { alert("Registration successful! You can now log in."); showLoginForm(); }
        }
        btn.disabled = false; btn.innerText = 'Register';
    }
    
    showLoginForm();
</script>
</body></html>
