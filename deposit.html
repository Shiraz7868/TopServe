<!-- deposit.html (Naya Base64 wala logic) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (head content waisa hi rahega) ... -->
    <style>
        /* ... (CSS waisi hi rahegi) ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- ... (Poora HTML waisa hi rahega) ... -->
    </div>
<script>
    const SUPABASE_URL = 'https://lyqdnxaxisnipeogtzfm.supabase.co';
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY'; // Apni key daalein
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    let currentUser = null;
    let screenshotDataUrl = null; // Screenshot ka Base64 data save karne ke liye

    // ... (DOM Elements aur checkUser function waisay hi hain) ...

    // Screenshot upload handling (Updated)
    document.getElementById('screenshot-file').addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) {
            const file = e.target.files[0];
            if (file.size > 2 * 1024 * 1024) { // Limit 2MB kar di
                alert("Image is too large. Please upload an image under 2MB.");
                return;
            }
            const reader = new FileReader();
            reader.onload = (event) => {
                // Base64 data ko variable mein save karein
                screenshotDataUrl = event.target.result;
                document.getElementById('screenshot-preview').src = screenshotDataUrl;
                document.getElementById('screenshot-preview').style.display = 'block';
            };
            reader.readAsDataURL(file);
            document.getElementById('submit-deposit-btn').disabled = false;
        }
    });

    // Submit Deposit Request (Updated)
    document.getElementById('submit-deposit-btn').addEventListener('click', async () => {
        if (!screenshotDataUrl) {
            alert("Please upload a screenshot.");
            return;
        }
        
        const submitBtn = document.getElementById('submit-deposit-btn');
        submitBtn.disabled = true;
        submitBtn.innerText = "Submitting...";

        // Ab hum Supabase Storage istemal nahi kar rahe
        const request = {
            user_id: currentUser.id,
            method: document.getElementById('method').value,
            amount: document.getElementById('amount').value,
            sender_number: document.getElementById('sender-number').value,
            // Direct Base64 text ko database mein bhejien
            screenshot_base64: screenshotDataUrl 
        };

        const { data: requestData, error: requestError } = await supabaseClient.from('deposit_requests').insert(request).select().single();
        
        if (requestError) {
            alert("Error submitting request: " + requestError.message);
        } else {
            // ... (Confirmation screen waisi hi hai) ...
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
        }
        submitBtn.disabled = false;
        submitBtn.innerText = "Submit Deposit Request";
    });
    
    // ... (Baqi ka JS code waisa hi rahega) ...
</script>
</body>
</html>
