<!DOCTYPE html><html lang="en"><head><title>Deposit History</title><link rel="stylesheet" href="style.css"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script></head><body>
<div class="container">
    <button onclick="window.location.href='dashboard.html'" style="width:auto; margin-bottom:20px;">‚Üê Back to Dashboard</button>
    <h2>Your Deposit History</h2>
    <table class="history-table">
        <thead><tr><th>Request ID</th><th>Amount</th><th>Method</th><th>Status</th><th>Date</th></tr></thead>
        <tbody id="history-body"></tbody>
    </table>
</div>
<script>
    const SUPABASE_URL = 'https://lyqdnxaxisnipeogtzfm.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5cWRueGF4aXNuaXBlb2d0emZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MDA5NzEsImV4cCI6MjA2NzE3Njk3MX0.RLhRacgqtvXk2-qaQ3ZCLYkcshg5_kIN5Mko6WMouWw';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    async function loadHistory() {
        const { data: { user } } = await supabaseClient.auth.getUser();
        if (!user) { window.location.href = 'auth.html'; return; }

        const { data, error } = await supabaseClient.from('deposit_requests').select('*').eq('user_id', user.id).order('created_at', { ascending: false });
        const tableBody = document.getElementById('history-body');
        tableBody.innerHTML = '';
        if (data.length === 0) { tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No history found.</td></tr>`; return; }
        data.forEach(req => {
            const row = `<tr>
                <td>${req.id}</td>
                <td>${req.amount} PKR</td>
                <td>${req.method}</td>
                <td><span class="status ${req.status}">${req.status}</span></td>
                <td>${new Date(req.created_at).toLocaleDateString()}</td>
            </tr>`;
            tableBody.innerHTML += row;
        });
    }
    loadHistory();
</script>
</body></html>
